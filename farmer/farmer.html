<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriVerse - Farmer Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --primary-light: #4caf50;
            --secondary: #ff9800;
            --accent: #2196f3;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #9e9e9e;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Navigation Styles */
        nav {
            background-color: white;
            padding: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-right: 0;
        }

        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background-color: rgba(46, 125, 50, 0.05);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .nav-links i {
            font-size: 1.1rem;
        }

        /* Main Content Styles */
        main {
            padding: 2rem 0;
            min-height: calc(100vh - 140px);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .bg-primary {
            background-color: var(--primary);
        }

        .bg-accent {
            background-color: var(--accent);
        }

        .bg-secondary {
            background-color: var(--secondary);
        }

        .bg-success {
            background-color: var(--success);
        }

        .token-balance {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .status-growing {
            background-color: rgba(76, 175, 80, 0.15);
            color: var(--success);
        }

        .status-planting {
            background-color: rgba(255, 152, 0, 0.15);
            color: var(--warning);
        }

        .status-harvest {
            background-color: rgba(33, 150, 243, 0.15);
            color: var(--accent);
        }

        .progress-container {
            margin-top: 1rem;
        }

        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .weather-risk {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 1rem;
        }

        .risk-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .risk-low {
            background-color: var(--success);
        }

        .risk-medium {
            background-color: var(--warning);
        }

        .risk-high {
            background-color: var(--danger);
        }

        /* Wallet Styles */
        .balance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .balance-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .balance-card h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .balance-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }

        .transaction-history {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .transaction-history th,
        .transaction-history td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .transaction-history th {
            background-color: #f5f5f5;
            font-weight: 600;
            color: var(--dark);
        }

        .transaction-history tr:last-child td {
            border-bottom: none;
        }

        .transaction-positive {
            color: var(--success);
            font-weight: 600;
        }

        .transaction-negative {
            color: var(--danger);
            font-weight: 600;
        }

        /* Marketplace Styles */
        .category-filters {
            display: flex;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-filter {
            padding: 0.7rem 1.5rem;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .category-filter.active,
        .category-filter:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            width: 100%;
            height: 150px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 3rem;
        }

        .product-content {
            padding: 1.5rem;
        }

        .product-category {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .product-description {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .buy-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }

        .buy-button:hover {
            background-color: var(--primary-dark);
        }

        .buy-button:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }

        /* Enhanced Update Styles */
        .update-form-container {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .file-upload-container {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .file-upload-container:hover {
            border-color: var(--primary);
            background-color: rgba(46, 125, 50, 0.05);
        }

        .file-upload-container.dragover {
            border-color: var(--primary);
            background-color: rgba(46, 125, 50, 0.1);
        }

        .file-upload-icon {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .file-upload-text {
            margin-bottom: 1rem;
        }

        .file-upload-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .file-upload-btn:hover {
            background-color: var(--primary-dark);
        }

        .file-upload-input {
            display: none;
        }

        .image-preview {
            display: none;
            margin-top: 1rem;
            text-align: center;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .remove-image {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .submit-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .submit-button:hover {
            background-color: var(--primary-dark);
        }

        /* Enhanced Updates List Styles */
        .updates-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .update-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .update-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .update-header {
            padding: 1.5rem 1.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .update-date {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .update-day {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .update-content {
            padding: 1rem 1.5rem;
        }

        .update-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
        }

        .update-description {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .update-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .update-divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 1rem 0;
        }

        /* Investment Section Styles */
        .investment-section {
            background: linear-gradient(135deg, #ffecb3, #ffd54f);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .investment-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #5d4037;
        }

        .investment-amount {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .currency {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5d4037;
        }

        .amount-input {
            width: 200px;
            padding: 0.75rem;
            border: 2px solid #ffb300;
            border-radius: 6px;
            font-size: 1.2rem;
            text-align: center;
            font-weight: bold;
            color: #5d4037;
        }

        .invest-button {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .invest-button:hover {
            background-color: #f57c00;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #e0e0e0;
        }

        /* Funding Styles */
        .funding-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .funding-card {
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            color: white;
        }

        .funding-requested {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .funding-received {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
        }

        .funding-available {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }

        .funding-amount {
            font-size: 2rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }

        .investor-list {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .investor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .investor-item:last-child {
            border-bottom: none;
        }

        .investor-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .investor-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--dark);
        }

        .investor-details h4 {
            margin-bottom: 0.2rem;
        }

        .investor-details p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .investment-amount {
            font-weight: bold;
            color: var(--primary);
        }

        .request-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .request-button:hover {
            background-color: #f57c00;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .toast.active {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background-color: var(--danger);
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
            }

            .nav-links a {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }

            .dashboard-grid,
            .balance-summary,
            .funding-status {
                grid-template-columns: 1fr;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .investment-amount {
                flex-direction: column;
            }

            .amount-input {
                width: 100%;
            }
        }

        .nav-links li {
            margin-right: 15px;
        }

        .nav-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        nav {
            overflow-x: auto;
            white-space: nowrap;
        }
    </style>
</head>

<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-tractor"></i>
                <span>AgriVerse</span>
            </div>
            <div class="user-info">
                <div class="user-avatar">R</div>
                <div>
                    <div>Ramesh</div>
                    <div style="font-size: 0.8rem; opacity: 0.8;">Telangana</div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-th-large"></i>
                        Dashboard</a></li>
                <li><a href="#" class="nav-link" data-page="wallet"><i class="fas fa-wallet"></i> Token Wallet</a></li>
                <li><a href="#" class="nav-link" data-page="marketplace"><i class="fas fa-store"></i> Marketplace</a>
                </li>
                <li><a href="#" class="nav-link" data-page="updates"><i class="fas fa-upload"></i> Farm Updates</a></li>
                <li><a href="#" class="nav-link" data-page="funding"><i class="fas fa-hand-holding-usd"></i> Funding</a>
                </li>
                <li><a href="/farmer/Revenue.html" class="nav-link" id="estimator-btn"><i class="fas fa-wallet"></i>
                        Estimator</a></li>
                <li style="margin-left: auto;">
                    <a href="/login-page.html" class="nav-link" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </li>

            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- Dashboard Page -->
        <section id="dashboard" class="page active">
            <div class="page-header">
                <h2>Farmer Dashboard</h2>
                <div class="weather-risk">
                    <div class="risk-indicator risk-low"></div>
                    <span>Low Weather Risk</span>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Farmer Profile</div>
                        <div class="card-icon bg-primary">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <p><strong>Name:</strong> <span id="farmer_name"></span></p>
                    <p><strong>Location:</strong> <span id="farmer_location"></span></p>
                    <p><strong>Crop:</strong> <span id="farmer_crop"></span></p>
                    <p><strong>Farm Size:</strong> <span id="farmer_land"></span></p>

                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Token Balance</div>
                        <div class="card-icon bg-accent">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                    <div class="token-balance">3,200 Tokens</div>
                    <p>Available for farm inputs</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Season Status</div>
                        <div class="card-icon bg-secondary">
                            <i class="fas fa-seedling"></i>
                        </div>
                    </div>
                    <p><strong>Current Phase:</strong> Growing</p>
                    <p><strong>Days in Cycle:</strong> 42 Days</p>
                    <span class="status-indicator status-growing">
                        <i class="fas fa-chart-line"></i> Growing
                    </span>

                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <div class="progress-text">
                            <span>Planted</span>
                            <span>Harvest</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Next Harvest</div>
                        <div class="card-icon bg-success">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>
                    <p><strong>Expected Date:</strong> December 30, 2023</p>
                    <p><strong>Days Remaining:</strong> 45 days</p>
                    <p><strong>Estimated Yield:</strong> 4.2 tons/hectare</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Recent Activity</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div>
                        <p><i class="fas fa-shopping-cart" style="color: var(--primary); margin-right: 8px;"></i>
                            Purchased fertilizer (300 tokens)</p>
                        <p><i class="fas fa-upload" style="color: var(--accent); margin-right: 8px;"></i> Uploaded farm
                            update - Day 40</p>
                    </div>
                    <div>
                        <p><i class="fas fa-hand-holding-usd" style="color: var(--success); margin-right: 8px;"></i>
                            Received investment from Investor B (1,500 tokens)</p>
                        <p><i class="fas fa-tint" style="color: var(--accent); margin-right: 8px;"></i> Irrigation
                            system activated</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Wallet Page -->
        <section id="wallet" class="page">
            <div class="page-header">
                <h2>Token Wallet</h2>
                <button class="request-button" id="request-funds-btn">
                    <i class="fas fa-plus"></i> Request Funds
                </button>
            </div>

            <div class="balance-summary">
                <div class="balance-card">
                    <h3>Total Received</h3>
                    <div class="balance-amount">5,000</div>
                    <p>Tokens from investors</p>
                </div>

                <div class="balance-card" style="background: linear-gradient(135deg, var(--accent), #1976d2);">
                    <h3>Current Balance</h3>
                    <div class="balance-amount">3,200</div>
                    <p>Available tokens</p>
                </div>

                <div class="balance-card" style="background: linear-gradient(135deg, var(--secondary), #f57c00);">
                    <h3>Total Spent</h3>
                    <div class="balance-amount">1,800</div>
                    <p>On farm inputs</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Transaction History</div>
                </div>
                <table class="transaction-history">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2023-11-10</td>
                            <td>Irrigation equipment</td>
                            <td class="transaction-negative">- 400 Tokens</td>
                            <td>3,200</td>
                        </tr>
                        <tr>
                            <td>2023-11-05</td>
                            <td>Investment from Investor B</td>
                            <td class="transaction-positive">+ 1,500 Tokens</td>
                            <td>3,600</td>
                        </tr>
                        <tr>
                            <td>2023-10-25</td>
                            <td>Fertilizer purchase</td>
                            <td class="transaction-negative">- 300 Tokens</td>
                            <td>2,100</td>
                        </tr>
                        <tr>
                            <td>2023-10-20</td>
                            <td>Seeds purchase</td>
                            <td class="transaction-negative">- 500 Tokens</td>
                            <td>2,400</td>
                        </tr>
                        <tr>
                            <td>2023-10-15</td>
                            <td>Investment from Investor A</td>
                            <td class="transaction-positive">+ 2,000 Tokens</td>
                            <td>2,900</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Marketplace Page -->
        <section id="marketplace" class="page">
            <div class="page-header">
                <h2>Marketplace</h2>
                <div>Use your tokens to purchase farming inputs</div>
            </div>

            <div class="category-filters">
                <button class="category-filter active" data-category="all">
                    <i class="fas fa-th"></i> All Items
                </button>
                <button class="category-filter" data-category="seeds">
                    <i class="fas fa-seedling"></i> Seeds
                </button>
                <button class="category-filter" data-category="fertilizers">
                    <i class="fas fa-flask"></i> Fertilizers
                </button>
                <button class="category-filter" data-category="machinery">
                    <i class="fas fa-tractor"></i> Machinery
                </button>
                <button class="category-filter" data-category="irrigation">
                    <i class="fas fa-tint"></i> Irrigation
                </button>
                <button class="category-filter" data-category="veterinary">
                    <i class="fas fa-paw"></i> Veterinary/Feed
                </button>
            </div>

            <div class="products-grid">
                <!-- Seeds -->
                <div class="product-card" data-category="seeds">
                    <div class="product-image">
                        <i class="fas fa-seedling" style="color: #4caf50;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Seeds</div>
                        <div class="product-name">Paddy Seeds (High Yield)</div>
                        <div class="product-description">High yield variety, suitable for Telangana climate</div>
                        <div class="product-footer">
                            <div class="product-price">500 Tokens</div>
                            <button class="buy-button" data-item="Paddy Seeds" data-price="500">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-category="seeds">
                    <div class="product-image">
                        <i class="fas fa-seedling" style="color: #4caf50;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Seeds</div>
                        <div class="product-name">Wheat Seeds (Organic)</div>
                        <div class="product-description">Certified organic seeds, no chemical treatment</div>
                        <div class="product-footer">
                            <div class="product-price">450 Tokens</div>
                            <button class="buy-button" data-item="Wheat Seeds" data-price="450">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Fertilizers -->
                <div class="product-card" data-category="fertilizers">
                    <div class="product-image">
                        <i class="fas fa-flask" style="color: #8d6e63;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Fertilizers</div>
                        <div class="product-name">NPK Fertilizer (50kg)</div>
                        <div class="product-description">Balanced NPK ratio for optimal growth</div>
                        <div class="product-footer">
                            <div class="product-price">300 Tokens</div>
                            <button class="buy-button" data-item="NPK Fertilizer" data-price="300">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-category="fertilizers">
                    <div class="product-image">
                        <i class="fas fa-recycle" style="color: #795548;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Fertilizers</div>
                        <div class="product-name">Organic Compost (100kg)</div>
                        <div class="product-description">Rich organic compost for soil health</div>
                        <div class="product-footer">
                            <div class="product-price">400 Tokens</div>
                            <button class="buy-button" data-item="Organic Compost" data-price="400">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Machinery -->
                <div class="product-card" data-category="machinery">
                    <div class="product-image">
                        <i class="fas fa-tractor" style="color: #f44336;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Machinery Rental</div>
                        <div class="product-name">Tractor Rental (1 Day)</div>
                        <div class="product-description">Modern tractor with operator for field work</div>
                        <div class="product-footer">
                            <div class="product-price">800 Tokens</div>
                            <button class="buy-button" data-item="Tractor Rental" data-price="800">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-category="machinery">
                    <div class="product-image">
                        <i class="fas fa-truck-loading" style="color: #ff9800;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Machinery Rental</div>
                        <div class="product-name">Harvester Rental (1 Day)</div>
                        <div class="product-description">Combine harvester for efficient harvesting</div>
                        <div class="product-footer">
                            <div class="product-price">1,200 Tokens</div>
                            <button class="buy-button" data-item="Harvester Rental" data-price="1200">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Irrigation -->
                <div class="product-card" data-category="irrigation">
                    <div class="product-image">
                        <i class="fas fa-tint" style="color: #2196f3;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Irrigation</div>
                        <div class="product-name">Drip Irrigation Kit</div>
                        <div class="product-description">Complete drip irrigation system for 1 acre</div>
                        <div class="product-footer">
                            <div class="product-price">600 Tokens</div>
                            <button class="buy-button" data-item="Drip Irrigation Kit" data-price="600">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-category="irrigation">
                    <div class="product-image">
                        <i class="fas fa-water" style="color: #03a9f4;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Irrigation</div>
                        <div class="product-name">Water Pump</div>
                        <div class="product-description">Electric water pump for irrigation</div>
                        <div class="product-footer">
                            <div class="product-price">750 Tokens</div>
                            <button class="buy-button" data-item="Water Pump" data-price="750">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Veterinary -->
                <div class="product-card" data-category="veterinary">
                    <div class="product-image">
                        <i class="fas fa-paw" style="color: #795548;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Veterinary/Feed</div>
                        <div class="product-name">Cattle Feed (50kg)</div>
                        <div class="product-description">Nutritious cattle feed with vitamins</div>
                        <div class="product-footer">
                            <div class="product-price">350 Tokens</div>
                            <button class="buy-button" data-item="Cattle Feed" data-price="350">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-category="veterinary">
                    <div class="product-image">
                        <i class="fas fa-syringe" style="color: #e91e63;"></i>
                    </div>
                    <div class="product-content">
                        <div class="product-category">Veterinary/Feed</div>
                        <div class="product-name">Livestock Medicine Kit</div>
                        <div class="product-description">Essential medicines for livestock health</div>
                        <div class="product-footer">
                            <div class="product-price">550 Tokens</div>
                            <button class="buy-button" data-item="Livestock Medicine" data-price="550">
                                <i class="fas fa-shopping-cart"></i> Buy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Enhanced Updates Page -->
        <section id="updates" class="page">
            <div class="page-header">
                <h2>Farm Updates</h2>
                <div>Share daily progress with your investors</div>
            </div>

            <!-- Update Form -->
            <div class="update-form-container">
                <h3 style="margin-bottom: 1.5rem; color: var(--primary-dark);">Create New Update</h3>

                <div class="form-group">
                    <label for="update-date">Date</label>
                    <input type="date" id="update-date" value="2023-11-15">
                </div>

                <div class="form-group">
                    <label for="update-day">Day in Crop Cycle</label>
                    <input type="number" id="update-day" placeholder="e.g., 42" value="42">
                </div>

                <div class="form-group">
                    <label for="update-title">Update Title</label>
                    <input type="text" id="update-title" placeholder="e.g., First Sprouting Appeared"
                        value="First Sprouting Appeared">
                </div>

                <div class="form-group">
                    <label for="update-description">Description</label>
                    <textarea id="update-description"
                        placeholder="Describe your farm progress...">The first sprouts have appeared! The fields are turning a beautiful shade of green. Everything is on track for a bountiful harvest.</textarea>
                </div>

                <div class="form-group">
                    <label>Upload Photo</label>
                    <div class="file-upload-container" id="file-upload-container">
                        <div class="file-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="file-upload-text">
                            <p>Drag & drop your image here or click to browse</p>
                            <p style="font-size: 0.9rem; color: var(--gray);">Supports JPG, PNG (Max 5MB)</p>
                        </div>
                        <button class="file-upload-btn">
                            <i class="fas fa-folder-open"></i> Choose Image
                        </button>
                        <input type="file" id="update-photo" class="file-upload-input" accept="image/*">
                    </div>
                    <div class="image-preview" id="image-preview">
                        <img src="" alt="Preview" class="preview-image" id="preview-image">
                        <button class="remove-image" id="remove-image">
                            <i class="fas fa-times"></i> Remove Image
                        </button>
                    </div>
                </div>

                <button class="submit-button" id="submit-update">
                    <i class="fas fa-paper-plane"></i> Publish Update
                </button>
            </div>

            <!-- Updates List -->
            <div class="updates-list" id="updates-list">
                <!-- Updates will be dynamically added here -->
            </div>

            <!-- Investment Section -->
            <div class="investment-section">
                <div class="investment-title">Invest in Golden Fields</div>
                <div class="investment-amount">
                    <span class="currency"></span>
                    <input type="number" class="amount-input" value="50000" min="1000" step="1000">
                </div>
                <button class="invest-button">
                    <i class="fas fa-chart-line"></i> Simulate Investment
                </button>
            </div>
        </section>

        <!-- Funding Page -->
        <section id="funding" class="page">
            <div class="page-header">
                <h2>Funding Requests</h2>
                <button class="request-button" id="create-request-btn">
                    <i class="fas fa-plus"></i> Create Request
                </button>
            </div>

            <div class="funding-status">
                <div class="funding-card funding-requested">
                    <h3>Total Requested</h3>
                    <div class="funding-amount">5,000</div>
                    <p>Tokens from investors</p>
                </div>

                <div class="funding-card funding-received">
                    <h3>Currently Available</h3>
                    <div class="funding-amount">3,200</div>
                    <p>For farm operations</p>
                </div>

                <div class="funding-card funding-available">
                    <h3>Additional Needed</h3>
                    <div class="funding-amount">1,800</div>
                    <p>For next season</p>
                </div>
            </div>

            <div class="investor-list">
                <h3 style="margin-bottom: 1rem;">Active Investors</h3>

                <div class="investor-item">
                    <div class="investor-info">
                        <div class="investor-avatar">A</div>
                        <div class="investor-details">
                            <h4>Investor A</h4>
                            <p>AgriFund Ventures</p>
                        </div>
                    </div>
                    <div class="investment-amount">2,000 tokens</div>
                </div>

                <div class="investor-item">
                    <div class="investor-info">
                        <div class="investor-avatar">B</div>
                        <div class="investor-details">
                            <h4>Investor B</h4>
                            <p>GreenGrowth Capital</p>
                        </div>
                    </div>
                    <div class="investment-amount">1,500 tokens</div>
                </div>

                <div class="investor-item">
                    <div class="investor-info">
                        <div class="investor-avatar">C</div>
                        <div class="investor-details">
                            <h4>Investor C</h4>
                            <p>Pending confirmation</p>
                        </div>
                    </div>
                    <div class="investment-amount">1,500 tokens</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Next Harvest Information</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                        <p><strong>Expected Date:</strong> December 30, 2023</p>
                        <p><strong>Days Remaining:</strong> 45 days</p>
                    </div>
                    <div>
                        <p><strong>Estimated Yield:</strong> 4.2 tons/hectare</p>
                        <p><strong>Market Price:</strong> 1,850/ton</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div class="modal" id="purchase-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Confirm Purchase</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="purchase-details">
                <!-- Purchase details will be inserted here -->
            </div>
            <div style="margin-top: 1.5rem; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-button" id="confirm-purchase">Confirm</button>
                <button class="request-button" style="background-color: #9e9e9e;" id="cancel-purchase">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="request-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Request Additional Funding</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="request-amount">Amount (Tokens)</label>
                <input type="number" id="request-amount" placeholder="Enter amount">
            </div>
            <div class="form-group">
                <label for="request-purpose">Purpose</label>
                <select id="request-purpose">
                    <option value="seeds">Seeds Purchase</option>
                    <option value="fertilizer">Fertilizer</option>
                    <option value="machinery">Machinery Rental</option>
                    <option value="irrigation">Irrigation</option>
                    <option value="labor">Labor Costs</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="request-description">Description</label>
                <textarea id="request-description" placeholder="Describe what you need the funding for..."></textarea>
            </div>
            <div style="margin-top: 1.5rem; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-button" id="submit-request">Submit Request</button>
                <button class="request-button" style="background-color: #9e9e9e;" id="cancel-request">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operation completed successfully!</span>
    </div>

    <script>
        // Application State
        const state = {
            tokenBalance: 0,
            transactions: [],
            updates: [
                {
                    id: 1,
                    date: '2023-11-13',
                    day: 40,
                    title: 'Sowing Season Begins!',
                    description: 'We have successfully completed the sowing of this season\'s wheat crop. The weather is perfect and we are expecting a great start.',
                    image: 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'
                },
                {
                    id: 2,
                    date: '2023-11-08',
                    day: 35,
                    title: 'First Sprouting',
                    description: 'The first sprouts have appeared! The fields are turning a beautiful shade of green. Everything is on track for a bountiful harvest.',
                    image: 'https://images.unsplash.com/photo-1592409065737-253c345eab84?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'
                }
            ]
        };

        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const categoryFilters = document.querySelectorAll('.category-filter');
        const productCards = document.querySelectorAll('.product-card');
        const buyButtons = document.querySelectorAll('.buy-button');
        const tokenBalanceElements = document.querySelectorAll('.token-balance, .balance-amount');
        const transactionTable = document.querySelector('.transaction-history tbody');
        const purchaseModal = document.getElementById('purchase-modal');
        const purchaseDetails = document.getElementById('purchase-details');
        const confirmPurchaseBtn = document.getElementById('confirm-purchase');
        const cancelPurchaseBtn = document.getElementById('cancel-purchase');
        const requestModal = document.getElementById('request-modal');
        const requestFundsBtn = document.getElementById('request-funds-btn');
        const createRequestBtn = document.getElementById('create-request-btn');
        const submitRequestBtn = document.getElementById('submit-request');
        const cancelRequestBtn = document.getElementById('cancel-request');
        const submitUpdateBtn = document.getElementById('submit-update');
        const fileUploadContainer = document.getElementById('file-upload-container');
        const fileUploadInput = document.getElementById('update-photo');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const removeImageBtn = document.getElementById('remove-image');
        const updatesList = document.getElementById('updates-list');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        // Current purchase item
        let currentPurchase = null;

        // Initialize the application
        function init() {
            // Set up navigation
            navLinks.forEach(link => {
                link.addEventListener('click', handleNavigation);
            });

            // Set up marketplace filters
            categoryFilters.forEach(filter => {
                filter.addEventListener('click', handleCategoryFilter);
            });

            // Set up purchase buttons
            buyButtons.forEach(button => {
                button.addEventListener('click', handlePurchaseClick);
            });

            // Set up modal buttons
            confirmPurchaseBtn.addEventListener('click', handleConfirmPurchase);
            cancelPurchaseBtn.addEventListener('click', () => purchaseModal.classList.remove('active'));
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    purchaseModal.classList.remove('active');
                    requestModal.classList.remove('active');
                });
            });

            // Set up funding request buttons
            requestFundsBtn.addEventListener('click', () => requestModal.classList.add('active'));
            createRequestBtn.addEventListener('click', () => requestModal.classList.add('active'));
            submitRequestBtn.addEventListener('click', handleSubmitRequest);
            cancelRequestBtn.addEventListener('click', () => requestModal.classList.remove('active'));

            // Set up enhanced update functionality
            fileUploadContainer.addEventListener('click', () => fileUploadInput.click());
            fileUploadContainer.addEventListener('dragover', handleDragOver);
            fileUploadContainer.addEventListener('dragleave', handleDragLeave);
            fileUploadContainer.addEventListener('drop', handleDrop);
            fileUploadInput.addEventListener('change', handleFileSelect);
            removeImageBtn.addEventListener('click', removeImage);
            submitUpdateBtn.addEventListener('click', handleSubmitUpdate);

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === purchaseModal) purchaseModal.classList.remove('active');
                if (e.target === requestModal) requestModal.classList.remove('active');
            });

            // Render initial data
            renderTransactions();
            renderUpdates();
            updateTokenBalance();

            // Set today's date as default
            document.getElementById('update-date').valueAsDate = new Date();
        }

        // Navigation handler
        function handleNavigation(e) {
            if (this.id === "logout-btn" || this.id === "estimator-btn") return;

            e.preventDefault();

            navLinks.forEach(link => link.classList.remove('active'));
            pages.forEach(page => page.classList.remove('active'));

            this.classList.add('active');
            const pageId = this.getAttribute('data-page');
            document.getElementById(pageId).classList.add('active');
        }



        // Category filter handler
        function handleCategoryFilter() {
            // Remove active class from all filters
            categoryFilters.forEach(filter => filter.classList.remove('active'));

            // Add active class to clicked filter
            this.classList.add('active');

            const category = this.getAttribute('data-category');

            // Show/hide products based on category
            productCards.forEach(product => {
                if (category === 'all' || product.getAttribute('data-category') === category) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        }

        // Purchase click handler
        function handlePurchaseClick() {
            const itemName = this.getAttribute('data-item');
            const itemPrice = parseInt(this.getAttribute('data-price'));

            currentPurchase = { name: itemName, price: itemPrice };

            // Update purchase modal content
            purchaseDetails.innerHTML = `
                <p>You are about to purchase:</p>
                <p style="font-weight: bold; margin: 10px 0;">${itemName}</p>
                <p>Price: <span style="color: var(--primary); font-weight: bold;">${itemPrice} Tokens</span></p>
                <p>Your current balance: <span style="font-weight: bold;">${state.tokenBalance} Tokens</span></p>
                <p>Balance after purchase: <span style="font-weight: bold;">${state.tokenBalance - itemPrice} Tokens</span></p>
            `;

            // Enable/disable confirm button based on balance
            if (state.tokenBalance >= itemPrice) {
                confirmPurchaseBtn.disabled = false;
                confirmPurchaseBtn.style.backgroundColor = '';
            } else {
                confirmPurchaseBtn.disabled = true;
                confirmPurchaseBtn.style.backgroundColor = '#9e9e9e';
            }

            // Show modal
            purchaseModal.classList.add('active');
        }

        // Confirm purchase handler
        function handleConfirmPurchase() {
            if (!currentPurchase) return;

            const { name, price } = currentPurchase;

            if (state.tokenBalance >= price) {
                // Update token balance
                state.tokenBalance -= price;

                // Add transaction
                const today = new Date().toISOString().split('T')[0];
                state.transactions.unshift({
                    date: today,
                    description: `${name} purchase`,
                    amount: -price,
                    balance: state.tokenBalance
                });

                // Update UI
                updateTokenBalance();
                renderTransactions();

                // Show success message
                showToast(`Successfully purchased ${name} for ${price} tokens!`);

                // Close modal
                purchaseModal.classList.remove('active');
                currentPurchase = null;
            } else {
                showToast('Insufficient tokens to complete this purchase.', true);
            }
        }

        // Submit funding request handler
        function handleSubmitRequest() {
            const amount = document.getElementById('request-amount').value;
            const purpose = document.getElementById('request-purpose').value;
            const description = document.getElementById('request-description').value;

            if (!amount || !description) {
                showToast('Please fill in all fields.', true);
                return;
            }

            // In a real app, this would send a request to the server
            showToast(`Funding request for ${amount} tokens submitted successfully!`);

            // Reset form and close modal
            document.getElementById('request-amount').value = '';
            document.getElementById('request-description').value = '';
            requestModal.classList.remove('active');
        }

        // Drag and drop handlers for image upload
        function handleDragOver(e) {
            e.preventDefault();
            fileUploadContainer.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            fileUploadContainer.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            fileUploadContainer.classList.remove('dragover');

            if (e.dataTransfer.files.length) {
                fileUploadInput.files = e.dataTransfer.files;
                handleFileSelect();
            }
        }

        // File selection handler
        function handleFileSelect() {
            const file = fileUploadInput.files[0];

            if (file) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };

                    reader.readAsDataURL(file);
                } else {
                    showToast('Please select a valid image file.', true);
                }
            }
        }

        // Remove image handler
        function removeImage() {
            fileUploadInput.value = '';
            imagePreview.style.display = 'none';
        }

        // Submit update handler
        function handleSubmitUpdate() {
            const date = document.getElementById('update-date').value;
            const day = document.getElementById('update-day').value;
            const title = document.getElementById('update-title').value;
            const description = document.getElementById('update-description').value;
            const imageFile = fileUploadInput.files[0];

            if (!date || !day || !title || !description) {
                showToast('Please fill in all fields.', true);
                return;
            }

            // Create new update object
            const newUpdate = {
                id: state.updates.length + 1,
                date: date,
                day: parseInt(day),
                title: title,
                description: description
            };

            // Handle image if provided
            if (imageFile) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    newUpdate.image = e.target.result;
                    addUpdateToState(newUpdate);
                };

                reader.readAsDataURL(imageFile);
            } else {
                addUpdateToState(newUpdate);
            }
        }

        // Add update to state and re-render
        function addUpdateToState(update) {
            // Add to beginning of updates array
            state.updates.unshift(update);

            // Re-render updates
            renderUpdates();

            // Reset form
            document.getElementById('update-title').value = '';
            document.getElementById('update-description').value = '';
            removeImage();

            // Show success message
            showToast('Farm update published successfully!');
        }

        // Render updates list
        function renderUpdates() {
            // Clear existing updates
            updatesList.innerHTML = '';

            if (state.updates.length === 0) {
                // Show empty state
                updatesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-images"></i>
                        <h3>No updates yet</h3>
                        <p>Share your first farm update to keep investors informed.</p>
                    </div>
                `;
                return;
            }

            // Add each update to the list
            state.updates.forEach(update => {
                const updateElement = document.createElement('div');
                updateElement.className = 'update-card';

                updateElement.innerHTML = `
                    <div class="update-header">
                        <div class="update-date">
                            <i class="far fa-calendar"></i>
                            ${formatDate(update.date)}
                        </div>
                        <div class="update-day">Day ${update.day}</div>
                    </div>
                    <div class="update-content">
                        <div class="update-title">${update.title}</div>
                        <div class="update-description">${update.description}</div>
                        ${update.image ? `<img src="${update.image}" alt="Farm update" class="update-image">` : ''}
                    </div>
                `;

                updatesList.appendChild(updateElement);
            });
        }

        // Update token balance in UI
        function updateTokenBalance() {
            tokenBalanceElements.forEach(element => {
                if (element.classList.contains('balance-amount') && element.parentElement.classList.contains('balance-card')) {
                    // For balance cards, just show the number
                    element.textContent = state.tokenBalance.toLocaleString();
                } else {
                    // For other elements, show with "Tokens"
                    element.textContent = `${state.tokenBalance.toLocaleString()} Tokens`;
                }
            });
        }

        // Render transaction history
        function renderTransactions() {
            // Clear existing rows
            transactionTable.innerHTML = '';

            // Add transactions
            state.transactions.forEach(transaction => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.description}</td>
                    <td class="${transaction.amount > 0 ? 'transaction-positive' : 'transaction-negative'}">
                        ${transaction.amount > 0 ? '+' : ''} ${transaction.amount} Tokens
                    </td>
                    <td>${transaction.balance.toLocaleString()}</td>
                `;

                transactionTable.appendChild(row);
            });
        }

        // Show toast notification
        function showToast(message, isError = false) {
            toastMessage.textContent = message;

            if (isError) {
                toast.classList.add('error');
            } else {
                toast.classList.remove('error');
            }

            toast.classList.add('active');

            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
    <script>
        async function loadFarmerData() {
            try {
                const response = await fetch("../backend/get-farmer-data.php");
                const result = await response.json();

                if (!result || result.status !== "OK" || !result.data) {
                    console.log("Returned:", result);
                    return alert("Session expired. Please login again.");
                }

                const farmer = result.data;

                // Safe DOM setters
                const setText = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value ? value : "N/A";
                };

                // Header avatar
                const avatar = document.querySelector(".user-avatar");
                if (avatar) avatar.textContent = farmer.name?.charAt(0) || "F";

                // Header name
                const headerName = document.querySelector(".user-info div div:first-child");
                if (headerName) headerName.textContent = farmer.name || "";

                // Header location
                const headerLoc = document.querySelector(".user-info div div:nth-child(2)");
                if (headerLoc) headerLoc.textContent = farmer.state || "";

                // Dashboard card
                setText("farmer_name", farmer.name);
                setText("farmer_location", farmer.state + ", " + farmer.district);
                setText("farmer_crop", farmer.farming_type);
                setText("farmer_land", farmer.land_area_acres + " Acres");

            } catch (error) {
                console.log("JS ERROR:", error);
                alert("Unable to load farmer details.");
            }
        }

        document.addEventListener("DOMContentLoaded", loadFarmerData);
    </script>
    <script>
        /* ==========================================================
       AgriVerse  Farmer Dashboard Client Script
       Features:
       - Profile load
       - Wallet balance (initially 0) + transactions
       - Marketplace dynamic loading
       - Purchases -> wallet update
       - Farm updates (multipart upload)
       - Funding requests (create + list)
       ----------------------------------------------------------
       Expected Backend Endpoints (return JSON):
       1) GET  ../backend/farmer/get_profile.php
          -> { status:"OK", data:{ name, state, district, village, farming_type, land_area_acres, ... } }
    
       2) GET  ../backend/wallet/get_balance.php
          -> { status:"OK", data:{ balance: number } }
          (If not implemented yet, return {balance:0})
    
       3) GET  ../backend/wallet/transactions.php
          -> { status:"OK", data:[ {id,date,description,amount,balance}, ... ] }
    
       4) GET  ../backend/marketplace/list_items.php
          -> { status:"OK", data:[ {id, name, category, price, image_url, description}, ... ] }
          categories: seeds|fertilizers|machinery|irrigation|veterinary
    
       5) POST ../backend/wallet/purchase.php
          body: FormData { item_id }
          -> { status:"OK", data:{ new_balance:number, transaction:{ date, description, amount, balance } } }
          or { status:"ERR", message:"Insufficient balance" }
    
       6) POST ../backend/farm_updates/create.php
          body: FormData { date, day, title, description, photo(file optional) }
          -> { status:"OK", data:{ id,date,day,title,description,image_url } }
    
       7) GET  ../backend/farm_updates/list.php
          -> { status:"OK", data:[ { id,date,day,title,description,image_url }, ... ] }
    
       8) POST ../backend/funding/create_request.php
          body: FormData { amount, purpose, description }
          -> { status:"OK" }
    
       9) GET  ../backend/funding/list_requests.php
          -> { status:"OK", data:[ { id, amount, purpose, description, status, created_at }, ... ] }
    ========================================================== */

        (function () {
            // --------- DOM refs from your existing farmer.html ----------
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');

            // Profile bits in header + card
            const headerNameEl = document.querySelector('.user-info > div:first-child') || null; // "R"
            const headerNameBlock = document.querySelector('.user-info > div:last-child > div:first-child'); // name text
            const headerLocBlock = document.querySelector('.user-info > div:last-child > div:last-child');   // state text

            // Profile card fields (in Dashboard page  adjust selectors if needed)
            const profileCard = document.querySelector('#dashboard .card'); // first card in your grid
            // Transaction table
            const transactionTbody = document.querySelector('.transaction-history tbody');
            // Balance elements
            const balanceCards = document.querySelectorAll('.balance-amount');
            const tokenBalanceTextEls = document.querySelectorAll('.token-balance');

            // Marketplace
            const categoryFilters = document.querySelectorAll('.category-filter');
            const productsGrid = document.querySelector('.products-grid');

            // Purchase modal
            const purchaseModal = document.getElementById('purchase-modal');
            const purchaseDetails = document.getElementById('purchase-details');
            const confirmPurchaseBtn = document.getElementById('confirm-purchase');
            const cancelPurchaseBtn = document.getElementById('cancel-purchase');

            // Funding
            const requestModal = document.getElementById('request-modal');
            const requestFundsBtn = document.getElementById('request-funds-btn');
            const createRequestBtn = document.getElementById('create-request-btn');
            const submitRequestBtn = document.getElementById('submit-request');
            const cancelRequestBtn = document.getElementById('cancel-request');

            // Add a container to list funding requests (if not present)
            let fundingRequestsContainer = document.getElementById('funding-requests-list');
            if (!fundingRequestsContainer) {
                fundingRequestsContainer = document.createElement('div');
                fundingRequestsContainer.id = 'funding-requests-list';
                fundingRequestsContainer.className = 'card';
                fundingRequestsContainer.innerHTML = `
      <div class="card-header">
        <div class="card-title">Your Funding Requests</div>
      </div>
      <div class="funding-requests-body" style="padding:1rem;"></div>
    `;
                const fundingPage = document.getElementById('funding');
                fundingPage.appendChild(fundingRequestsContainer);
            }
            const fundingRequestsBody = fundingRequestsContainer.querySelector('.funding-requests-body');

            // Updates
            const updatesList = document.getElementById('updates-list');
            const submitUpdateBtn = document.getElementById('submit-update');
            const updateDate = document.getElementById('update-date');
            const updateDay = document.getElementById('update-day');
            const updateTitle = document.getElementById('update-title');
            const updateDescription = document.getElementById('update-description');
            const fileUploadInput = document.getElementById('update-photo');

            // Toast
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-message');

            // State
            const state = {
                tokenBalance: 0, // start at 0 until fetched
                transactions: [],
                marketplace: [],
                currentPurchase: null,
            };

            // ------------------- Helpers -------------------
            function showToast(message, isError = false) {
                toastMsg.textContent = message;
                toast.classList.toggle('error', !!isError);
                toast.classList.add('active');
                setTimeout(() => toast.classList.remove('active'), 3000);
            }

            function money(n) {
                return Number(n || 0).toLocaleString();
            }

            async function api(url, { method = 'GET', body = null } = {}) {
                const opts = { method };
                if (body instanceof FormData) {
                    opts.body = body;
                } else if (body) {
                    opts.headers = { 'Content-Type': 'application/json' };
                    opts.body = JSON.stringify(body);
                }
                const res = await fetch(url, opts);
                const text = await res.text();
                try {
                    return JSON.parse(text);
                } catch {
                    // If backend sends plain error string
                    return { status: 'ERR', message: text || 'Unexpected server response' };
                }
            }

            function setActivePage(pageId) {
                pages.forEach(p => p.classList.toggle('active', p.id === pageId));
                navLinks.forEach(a => a.classList.toggle('active', a.dataset.page === pageId));
            }

            // ------------------- Loaders -------------------
            async function loadProfile() {
                const out = await api('../backend/farmer/get_profile.php');
                if (out.status !== 'OK') {
                    showToast('Unable to load farmer profile', true);
                    return;
                }
                const d = out.data;

                // Header
                if (headerNameEl) headerNameEl.textContent = (d.name || 'U')?.[0]?.toUpperCase() || 'U';
                if (headerNameBlock) headerNameBlock.textContent = d.name || 'Farmer';
                if (headerLocBlock) headerLocBlock.textContent = (d.state || '');

                // Profile card (assumes your first .card is profile  adjust if needed)
                if (profileCard) {
                    profileCard.querySelector('.card-title')?.textContent = 'Farmer Profile';
                    const ps = profileCard.querySelectorAll('p');
                    // Keep your existing structure but overwrite values if present
                    if (ps[0]) ps[0].innerHTML = `<strong>Name:</strong> ${d.name || '-'}`;
                    if (ps[1]) ps[1].innerHTML = `<strong>Location:</strong> ${d.state || '-'}${d.district ? ', ' + d.district : ''}`;
                    if (ps[2]) ps[2].innerHTML = `<strong>Crop:</strong> ${d.farming_type || '-'}`;
                    if (ps[3]) ps[3].innerHTML = `<strong>Farm Size:</strong> ${d.land_area_acres ? Number(d.land_area_acres).toFixed(2) + ' Acres' : '-'}`;
                }
            }

            async function loadBalance() {
                const out = await api('../backend/wallet/get_balance.php');
                const balance = (out.status === 'OK' && out.data && typeof out.data.balance !== 'undefined')
                    ? Number(out.data.balance)
                    : 0;
                state.tokenBalance = balance;
                updateBalanceUI();
            }

            async function loadTransactions() {
                const out = await api('../backend/wallet/transactions.php');
                state.transactions = (out.status === 'OK' && Array.isArray(out.data)) ? out.data : [];
                renderTransactions();
            }

            async function loadMarketplace() {
                const out = await api('../backend/marketplace/list_items.php');
                state.marketplace = (out.status === 'OK' && Array.isArray(out.data)) ? out.data : [];
                renderMarketplace('all');
            }

            async function loadUpdates() {
                const out = await api('../backend/farm_updates/list.php');
                const list = (out.status === 'OK' && Array.isArray(out.data)) ? out.data : [];
                renderUpdates(list);
            }

            async function loadFundingRequests() {
                const out = await api('../backend/funding/list_requests.php');
                const list = (out.status === 'OK' && Array.isArray(out.data)) ? out.data : [];
                renderFundingRequests(list);
            }

            // ------------------- Renderers -------------------
            function updateBalanceUI() {
                // Big balance cards (3 cards in Wallet)
                balanceCards.forEach((el, i) => {
                    // Only "Current Balance" card shows current balance.
                    // In your HTML the middle card is current balance. Well leave others as-is.
                    if (el.parentElement?.querySelector('h3')?.textContent?.toLowerCase().includes('current')) {
                        el.textContent = money(state.tokenBalance);
                    }
                });
                // Token balance on dashboard
                tokenBalanceTextEls.forEach(el => {
                    el.textContent = `${money(state.tokenBalance)} Tokens`;
                });
            }

            function renderTransactions() {
                if (!transactionTbody) return;
                transactionTbody.innerHTML = '';
                state.transactions.forEach(t => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
        <td>${t.date || ''}</td>
        <td>${t.description || ''}</td>
        <td class="${(t.amount || 0) > 0 ? 'transaction-positive' : 'transaction-negative'}">
          ${(t.amount || 0) > 0 ? '+' : ''} ${t.amount} Tokens
        </td>
        <td>${money(t.balance)}</td>
      `;
                    transactionTbody.appendChild(tr);
                });
            }

            function productCardHTML(item) {
                const iconByCategory = {
                    seeds: '<i class="fas fa-seedling" style="color:#4caf50;"></i>',
                    fertilizers: '<i class="fas fa-flask" style="color:#8d6e63;"></i>',
                    machinery: '<i class="fas fa-tractor" style="color:#f44336;"></i>',
                    irrigation: '<i class="fas fa-tint" style="color:#2196f3;"></i>',
                    veterinary: '<i class="fas fa-paw" style="color:#795548;"></i>',
                };
                const icon = iconByCategory[item.category] || '<i class="fas fa-box-open"></i>';
                return `
      <div class="product-card" data-category="${item.category}" data-id="${item.id}">
        <div class="product-image">
          ${item.image_url ? `<img src="${item.image_url}" alt="${item.name}" style="width:100%;height:150px;object-fit:cover;">` : icon}
        </div>
        <div class="product-content">
          <div class="product-category">${(item.category || '').toUpperCase()}</div>
          <div class="product-name">${item.name || ''}</div>
          <div class="product-description">${item.description || ''}</div>
          <div class="product-footer">
            <div class="product-price">${money(item.price)} Tokens</div>
            <button class="buy-button" data-item="${item.name}" data-id="${item.id}" data-price="${item.price}">
              <i class="fas fa-shopping-cart"></i> Buy
            </button>
          </div>
        </div>
      </div>
    `;
            }

            function renderMarketplace(activeCategory = 'all') {
                if (!productsGrid) return;
                if (!state.marketplace.length) {
                    productsGrid.innerHTML = `
        <div class="empty-state" style="grid-column:1/-1">
          <i class="fas fa-store"></i>
          <h3>No items yet</h3>
          <p>Suppliers will add products soon.</p>
        </div>
      `;
                    return;
                }
                const filtered = state.marketplace.filter(p => activeCategory === 'all' || p.category === activeCategory);
                productsGrid.innerHTML = filtered.map(productCardHTML).join('');
                // Bind buy buttons
                productsGrid.querySelectorAll('.buy-button').forEach(btn => {
                    btn.addEventListener('click', onBuyClick);
                });
            }

            function renderUpdates(list) {
                updatesList.innerHTML = '';
                if (!list.length) {
                    updatesList.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-images"></i>
          <h3>No updates yet</h3>
          <p>Share your first farm update to keep investors informed.</p>
        </div>
      `;
                    return;
                }
                list.forEach(u => {
                    const div = document.createElement('div');
                    div.className = 'update-card';
                    div.innerHTML = `
        <div class="update-header">
          <div class="update-date"><i class="far fa-calendar"></i> ${formatDate(u.date)}</div>
          <div class="update-day">Day ${u.day}</div>
        </div>
        <div class="update-content">
          <div class="update-title">${u.title}</div>
          <div class="update-description">${u.description}</div>
          ${u.image_url ? `<img src="${u.image_url}" class="update-image" alt="Farm update">` : ''}
        </div>
      `;
                    updatesList.appendChild(div);
                });
            }

            function renderFundingRequests(list) {
                fundingRequestsBody.innerHTML = '';
                if (!list.length) {
                    fundingRequestsBody.innerHTML = `<div style="color:#777">No funding requests yet.</div>`;
                    return;
                }
                list.forEach(r => {
                    const row = document.createElement('div');
                    row.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;border-bottom:1px solid #eee;';
                    row.innerHTML = `
        <div>
          <div style="font-weight:600">${money(r.amount)} Tokens</div>
          <div style="font-size:0.9rem;color:#666">${(r.purpose || '').toUpperCase()}  ${r.description || ''}</div>
        </div>
        <div style="font-weight:600; ${r.status === 'rejected' ? 'color:#f44336' : r.status === 'approved' ? 'color:#4caf50' : 'color:#ff9800'}">
          ${r.status || 'pending'}
        </div>
      `;
                    fundingRequestsBody.appendChild(row);
                });
            }

            // ------------------- Handlers -------------------
            function formatDate(s) {
                try {
                    return new Date(s).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
                } catch { return s; }
            }

            function onBuyClick(e) {
                const btn = e.currentTarget;
                const id = btn.dataset.id;
                const name = btn.dataset.item;
                const price = Number(btn.dataset.price || 0);

                state.currentPurchase = { id, name, price };

                // Fill modal
                purchaseDetails.innerHTML = `
      <p>You are about to purchase:</p>
      <p style="font-weight:bold;margin:10px 0;">${name}</p>
      <p>Price: <span style="color:var(--primary);font-weight:bold;">${money(price)} Tokens</span></p>
      <p>Your current balance: <span style="font-weight:bold;">${money(state.tokenBalance)} Tokens</span></p>
      <p>Balance after purchase: <span style="font-weight:bold;">${money(state.tokenBalance - price)} Tokens</span></p>
    `;
                confirmPurchaseBtn.disabled = state.tokenBalance < price;
                confirmPurchaseBtn.style.backgroundColor = state.tokenBalance < price ? '#9e9e9e' : '';
                purchaseModal.classList.add('active');
            }

            async function confirmPurchase() {
                if (!state.currentPurchase) return;
                const fd = new FormData();
                fd.append('item_id', state.currentPurchase.id);

                const out = await api('../backend/wallet/purchase.php', { method: 'POST', body: fd });
                if (out.status !== 'OK') {
                    showToast(out.message || 'Purchase failed', true);
                    return;
                }

                // Update balance + transactions
                state.tokenBalance = Number(out.data.new_balance || 0);
                if (out.data.transaction) {
                    state.transactions.unshift(out.data.transaction);
                }
                updateBalanceUI();
                renderTransactions();

                purchaseModal.classList.remove('active');
                showToast(`Purchased ${state.currentPurchase.name} successfully!`);
                state.currentPurchase = null;
            }

            async function submitUpdate() {
                // Validate
                if (!updateDate.value || !updateDay.value || !updateTitle.value || !updateDescription.value) {
                    showToast('Please fill in all fields.', true);
                    return;
                }

                const fd = new FormData();
                fd.append('date', updateDate.value);
                fd.append('day', updateDay.value);
                fd.append('title', updateTitle.value);
                fd.append('description', updateDescription.value);
                if (fileUploadInput.files[0]) fd.append('photo', fileUploadInput.files[0]);

                const out = await api('../backend/farm_updates/create.php', { method: 'POST', body: fd });
                if (out.status !== 'OK') {
                    showToast(out.message || 'Failed to publish update', true);
                    return;
                }

                // Prepend new update
                const fresh = await api('../backend/farm_updates/list.php');
                const list = (fresh.status === 'OK' && Array.isArray(fresh.data)) ? fresh.data : [];
                renderUpdates(list);

                // Reset form
                updateTitle.value = '';
                updateDescription.value = '';
                updateDay.value = '';
                fileUploadInput.value = '';
                showToast('Farm update published successfully!');
            }

            async function submitFundingRequest() {
                const amount = document.getElementById('request-amount').value;
                const purpose = document.getElementById('request-purpose').value;
                const description = document.getElementById('request-description').value;

                if (!amount || !description) {
                    showToast('Please fill in amount and description.', true);
                    return;
                }

                const fd = new FormData();
                fd.append('amount', amount);
                fd.append('purpose', purpose);
                fd.append('description', description);

                const out = await api('../backend/funding/create_request.php', { method: 'POST', body: fd });
                if (out.status !== 'OK') {
                    showToast(out.message || 'Failed to create request', true);
                    return;
                }

                // reload list
                await loadFundingRequests();
                requestModal.classList.remove('active');
                document.getElementById('request-amount').value = '';
                document.getElementById('request-description').value = '';
                showToast('Funding request submitted!');
            }

            // ------------------- Events -------------------
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    setActivePage(link.dataset.page);
                });
            });

            // Category filters
            categoryFilters.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryFilters.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const cat = btn.dataset.category;
                    renderMarketplace(cat);
                });
            });

            // Modals
            confirmPurchaseBtn.addEventListener('click', confirmPurchase);
            cancelPurchaseBtn.addEventListener('click', () => purchaseModal.classList.remove('active'));
            document.querySelectorAll('.close-modal').forEach(x => {
                x.addEventListener('click', () => {
                    purchaseModal.classList.remove('active');
                    requestModal.classList.remove('active');
                });
            });
            window.addEventListener('click', (e) => {
                if (e.target === purchaseModal) purchaseModal.classList.remove('active');
                if (e.target === requestModal) requestModal.classList.remove('active');
            });

            // Funding modal buttons
            if (requestFundsBtn) requestFundsBtn.addEventListener('click', () => requestModal.classList.add('active'));
            if (createRequestBtn) createRequestBtn.addEventListener('click', () => requestModal.classList.add('active'));
            if (cancelRequestBtn) cancelRequestBtn.addEventListener('click', () => requestModal.classList.remove('active'));
            if (submitRequestBtn) submitRequestBtn.addEventListener('click', submitFundingRequest);

            // Updates
            if (submitUpdateBtn) submitUpdateBtn.addEventListener('click', submitUpdate);

            // ------------------- Init -------------------
            async function init() {
                // Start everything
                await Promise.all([
                    loadProfile(),
                    loadBalance(),
                    loadTransactions(),
                    loadMarketplace(),
                    loadUpdates(),
                    loadFundingRequests(),
                ]);
            }

            document.addEventListener('DOMContentLoaded', init);
        })();

    </script>
    <script>
        // Auto logout timer (10 minutes)
        let inactivityTimer;

        function resetLogoutTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                window.location.href = "../backend/logout.php?reason=timeout";
            }, 600000); // 10 minutes
        }

        // Reset timer on all interactions
        ["click", "mousemove", "keydown", "scroll", "touchstart"].forEach(evt => {
            document.addEventListener(evt, resetLogoutTimer);
        });

        // Start timer
        resetLogoutTimer();

    </script>

</body>

</html>